# Laravel Remote Code Execution when APP_KEY is leaked PoC (CVE-2018-15133)

This repository contains a plain Laravel application with one route (`POST /`) added to `routes/web.php` (see `Dockerfile`) and a PHP script to exploit CVE-2018-15133 in the application (`cve-2018-15133.php`).

```
# Launch the container and expose it on localhost:8000:
docker run -d -p 8000:8000 laravel-poc-cve-2018-15133
# or preferable build it locally and run it
```

To exploit this demo-app running Laravel 5.6.29:

The `APP_KEY` can be fetched from the container by execution:
```
docker exec -it $(docker ps --latest --quiet) grep -e \^APP_KEY /var/www/html/laravel/.env
```

Unserialize vulnerabilities makes it possible to create PHP Objects. An attacker typically look for objects that leads to executing shell commands directly or indirectly. One such function is `assert`, by calling `assert("system('id');");`, the `system` command is executed on the target system. This works for all versions of PHP before 7.2, because calling `assert` with a string was deprecated in PHP 7.2. Another way to gain code execution is to write a PHP file to disk that takes a query param value as input and executes it on the system. 

Security note: The docker image has on Docker Hub contains a hardcoded `APP_KEY`, if you build the docker image yourself it will generate a new `APP_KEY`, which is more secure. Do not use this Docker image for Laravel development.
hehe